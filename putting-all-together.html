<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 13 Putting All Together | Baseball Analytics Workshop (Morning Session)</title>
  <meta name="description" content="A brief tutorial on the Lahman and dplyr packages for the ASA Baseball Workshop.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 13 Putting All Together | Baseball Analytics Workshop (Morning Session)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A brief tutorial on the Lahman and dplyr packages for the ASA Baseball Workshop." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 Putting All Together | Baseball Analytics Workshop (Morning Session)" />
  
  <meta name="twitter:description" content="A brief tutorial on the Lahman and dplyr packages for the ASA Baseball Workshop." />
  

<meta name="author" content="Charles Redmond">


<meta name="date" content="2019-04-08">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="barplots.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Baseball Analytics Workshop</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Software Installation</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#install-r"><i class="fa fa-check"></i><b>1.1</b> Install R</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#windows"><i class="fa fa-check"></i><b>1.1.1</b> Windows</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#mac"><i class="fa fa-check"></i><b>1.1.2</b> Mac</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#rstudio"><i class="fa fa-check"></i><b>1.2</b> RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro-to-rstudio.html"><a href="intro-to-rstudio.html"><i class="fa fa-check"></i><b>2</b> Intro to RStudio</a></li>
<li class="chapter" data-level="3" data-path="install-lahman.html"><a href="install-lahman.html"><i class="fa fa-check"></i><b>3</b> Install Lahman</a></li>
<li class="chapter" data-level="4" data-path="a-look-at-the-tables.html"><a href="a-look-at-the-tables.html"><i class="fa fa-check"></i><b>4</b> A Look At The Tables</a></li>
<li class="chapter" data-level="5" data-path="install-dplyr.html"><a href="install-dplyr.html"><i class="fa fa-check"></i><b>5</b> Install dplyr</a></li>
<li class="chapter" data-level="6" data-path="selecting-filtering-and-arranging.html"><a href="selecting-filtering-and-arranging.html"><i class="fa fa-check"></i><b>6</b> Selecting, Filtering, and Arranging</a><ul>
<li class="chapter" data-level="6.1" data-path="selecting-filtering-and-arranging.html"><a href="selecting-filtering-and-arranging.html#select"><i class="fa fa-check"></i><b>6.1</b> Select</a></li>
<li class="chapter" data-level="6.2" data-path="selecting-filtering-and-arranging.html"><a href="selecting-filtering-and-arranging.html#scripts"><i class="fa fa-check"></i><b>6.2</b> Scripts</a></li>
<li class="chapter" data-level="6.3" data-path="selecting-filtering-and-arranging.html"><a href="selecting-filtering-and-arranging.html#filter"><i class="fa fa-check"></i><b>6.3</b> Filter</a></li>
<li class="chapter" data-level="6.4" data-path="selecting-filtering-and-arranging.html"><a href="selecting-filtering-and-arranging.html#arrange"><i class="fa fa-check"></i><b>6.4</b> Arrange</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="grouping.html"><a href="grouping.html"><i class="fa fa-check"></i><b>7</b> Grouping</a><ul>
<li class="chapter" data-level="7.1" data-path="grouping.html"><a href="grouping.html#the-basics"><i class="fa fa-check"></i><b>7.1</b> The Basics</a></li>
<li class="chapter" data-level="7.2" data-path="grouping.html"><a href="grouping.html#exercise"><i class="fa fa-check"></i><b>7.2</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="joins.html"><a href="joins.html"><i class="fa fa-check"></i><b>8</b> Joins</a><ul>
<li class="chapter" data-level="8.1" data-path="joins.html"><a href="joins.html#the-basics-1"><i class="fa fa-check"></i><b>8.1</b> The Basics</a></li>
<li class="chapter" data-level="8.2" data-path="joins.html"><a href="joins.html#exercise-1"><i class="fa fa-check"></i><b>8.2</b> Exercise 1</a></li>
<li class="chapter" data-level="8.3" data-path="joins.html"><a href="joins.html#exercise-2"><i class="fa fa-check"></i><b>8.3</b> Exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>9</b> ggplot</a><ul>
<li class="chapter" data-level="9.1" data-path="ggplot.html"><a href="ggplot.html#installation"><i class="fa fa-check"></i><b>9.1</b> Installation</a></li>
<li class="chapter" data-level="9.2" data-path="ggplot.html"><a href="ggplot.html#a-simple-plot"><i class="fa fa-check"></i><b>9.2</b> A Simple Plot</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="grouping-in-ggplot.html"><a href="grouping-in-ggplot.html"><i class="fa fa-check"></i><b>10</b> Grouping in ggplot</a></li>
<li class="chapter" data-level="11" data-path="facets-in-ggplot.html"><a href="facets-in-ggplot.html"><i class="fa fa-check"></i><b>11</b> Facets in ggplot</a></li>
<li class="chapter" data-level="12" data-path="barplots.html"><a href="barplots.html"><i class="fa fa-check"></i><b>12</b> Barplots</a></li>
<li class="chapter" data-level="13" data-path="putting-all-together.html"><a href="putting-all-together.html"><i class="fa fa-check"></i><b>13</b> Putting All Together</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Baseball Analytics Workshop (Morning Session)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="putting-all-together" class="section level1">
<h1><span class="header-section-number">Chapter 13</span> Putting All Together</h1>
<p>As a final exercise, let’s do the example from the last chapter, but with the Pirates as well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">phils&lt;-Batting <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">filter</span>(yearID <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1970</span> <span class="op">&amp;</span><span class="st"> </span>yearID <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1979</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">filter</span>(teamID <span class="op">==</span><span class="st"> &quot;PHI&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">summarize</span>(<span class="dt">decadeHR =</span> <span class="kw">sum</span>(HR),<span class="dt">decadeAB =</span> <span class="kw">sum</span>(AB)) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">playerTeam =</span> <span class="kw">paste</span>(playerID,<span class="st">&quot;PHI&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">team=</span><span class="st">&quot;phillies&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">select</span>(playerTeam,decadeHR,decadeAB,team) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">filter</span>(decadeAB <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1500</span>) 

<span class="kw">data.frame</span>(phils)</code></pre></div>
<pre><code>##     playerTeam decadeHR decadeAB     team
## 1 boonebo01PHI       52     2983 phillies
## 2  bowala01PHI       11     5915 phillies
## 3  cashda01PHI        7     2052 phillies
## 4 doylede01PHI        9     1567 phillies
## 5 luzingr01PHI      204     4262 phillies
## 6 maddoga01PHI       48     2622 phillies
## 7 montawi01PHI       63     2318 phillies
## 8 schmimi01PHI      235     3713 phillies</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pirates&lt;-Batting <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">filter</span>(yearID <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1970</span> <span class="op">&amp;</span><span class="st"> </span>yearID <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1979</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">filter</span>(teamID <span class="op">==</span><span class="st"> &quot;PIT&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">summarize</span>(<span class="dt">decadeHR =</span> <span class="kw">sum</span>(HR),<span class="dt">decadeAB =</span> <span class="kw">sum</span>(AB)) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">playerTeam =</span> <span class="kw">paste</span>(playerID,<span class="st">&quot;PIT&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">team=</span><span class="st">&quot;pirates&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">select</span>(playerTeam,decadeHR,decadeAB,team) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">filter</span>(decadeAB <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1500</span>) 

<span class="kw">data.frame</span>(pirates)</code></pre></div>
<pre><code>##      playerTeam decadeHR decadeAB    team
## 1   cashda01PIT        8     1549 pirates
## 2  garneph01PIT       38     1662 pirates
## 3  hebneri01PIT      113     3200 pirates
## 4  morenom01PIT       19     1830 pirates
## 5  oliveal01PIT      118     4555 pirates
## 6  parkeda01PIT      122     3294 pirates
## 7  roberbo01PIT      103     2051 pirates
## 8  robinbi02PIT       91     2020 pirates
## 9  sanguma01PIT       54     3888 pirates
## 10 stargwi01PIT      296     4399 pirates
## 11 stennre01PIT       38     4037 pirates
## 12 taverfr01PIT        1     2476 pirates
## 13  ziskri01PIT       69     2006 pirates</code></pre>
<p>There are a few new ideas here. First, we have used <strong>mutate</strong> to create two new columns. We created the “playerTeam” column by pasting the teamID onto the playerID. We did this because there is one player who played for both teams during the ’70’s and we need to have distinct categories. So “playerTeam” will be our category column instead of “playerID”. We have also added a “team” column so that we can easily distinguish between Phillies and Pirate records when plotting.</p>
<p>We can now stack the two data frames in this way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">philsPirates &lt;-<span class="st"> </span><span class="kw">rbind</span>(phils,pirates) <span class="op">%&gt;%</span>
<span class="st">                  </span><span class="kw">arrange</span>(decadeHR)

philsPirates<span class="op">$</span>playerTeam &lt;-<span class="st"> </span><span class="kw">factor</span>(philsPirates<span class="op">$</span>playerTeam,<span class="dt">levels=</span>philsPirates<span class="op">$</span>playerTeam)

<span class="kw">data.frame</span>(philsPirates)</code></pre></div>
<pre><code>##      playerTeam decadeHR decadeAB     team
## 1  taverfr01PIT        1     2476  pirates
## 2   cashda01PHI        7     2052 phillies
## 3   cashda01PIT        8     1549  pirates
## 4  doylede01PHI        9     1567 phillies
## 5   bowala01PHI       11     5915 phillies
## 6  morenom01PIT       19     1830  pirates
## 7  garneph01PIT       38     1662  pirates
## 8  stennre01PIT       38     4037  pirates
## 9  maddoga01PHI       48     2622 phillies
## 10 boonebo01PHI       52     2983 phillies
## 11 sanguma01PIT       54     3888  pirates
## 12 montawi01PHI       63     2318 phillies
## 13  ziskri01PIT       69     2006  pirates
## 14 robinbi02PIT       91     2020  pirates
## 15 roberbo01PIT      103     2051  pirates
## 16 hebneri01PIT      113     3200  pirates
## 17 oliveal01PIT      118     4555  pirates
## 18 parkeda01PIT      122     3294  pirates
## 19 luzingr01PHI      204     4262 phillies
## 20 schmimi01PHI      235     3713 phillies
## 21 stargwi01PIT      296     4399  pirates</code></pre>
<p>At the same time, we also arranged and factored.</p>
<p>Now we can plot the two together:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">data=</span>philsPirates,<span class="kw">aes</span>(<span class="dt">x=</span>playerTeam,<span class="dt">y=</span>decadeHR,<span class="dt">color=</span>team,<span class="dt">fill=</span>team),
           <span class="dt">stat=</span>(<span class="st">&quot;identity&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;black&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;lightskyblue&quot;</span>,<span class="st">&quot;gold&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<p>Finally, we can try faceting:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">data=</span>philsPirates,<span class="kw">aes</span>(<span class="dt">x=</span>playerTeam,<span class="dt">y=</span>decadeHR,<span class="dt">color=</span>team,<span class="dt">fill=</span>team),
           <span class="dt">stat=</span>(<span class="st">&quot;identity&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;black&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;lightskyblue&quot;</span>,<span class="st">&quot;gold&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(.<span class="op">~</span>team)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>Of course, the plot would be better had we used names instead of playerID as the categories.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="barplots.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
